name: Release

on:
  release:
    types: [ published, created ]

jobs:
  create-release:
    name: Create Release Package
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Create release package
      run: |
        VERSION=${GITHUB_REF#refs/tags/}
        PACKAGE_NAME="pzem-monitoring-${VERSION}.tar.gz"
        
        tar -czf ${PACKAGE_NAME} \
          dashboard/ \
          mqtt/ \
          docker-compose.yml \
          start.sh \
          nginx-pzem.conf \
          setup-nginx-ssl.sh \
          *.md \
          .github/
        
        echo "PACKAGE_NAME=${PACKAGE_NAME}" >> $GITHUB_ENV
        echo "Package created: ${PACKAGE_NAME}"

    - name: Upload release asset
      uses: actions/upload-artifact@v4
      with:
        name: release-package
        path: ${{ env.PACKAGE_NAME }}
        retention-days: 30

